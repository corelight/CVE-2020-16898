module CVE_2020_16898;
# A network detection package for CVE-2020-16898 (Windows TCP/IP Remote Code Execution Vulnerability)
# Tested on Zeek version 3.3.0-dev.329
# Author: Ben Reardon, Research Team @Corelight. ben.reardon@corelight.com, @benreardon
# Author: 
# Version: 0.1

export {
    redef enum Notice::Type += {
        CVE_2020_16898_exploit
    };
}

event icmp_router_advertisement(c: connection, info: icmp_info, cur_hop_limit: count, managed: bool, other: bool, home_agent: bool, pref: count, proxy: bool, rsv: count, router_lifetime: interval, reachable_time: interval, retrans_timer: interval, options: icmp6_nd_options)
    {
    if ( info$v6 && info$itype == 134 && options[0]$otype == 25 && (options[0]$len % 2) == 0 )
        {
         NOTICE([$note=CVE_2020_16898_exploit,
                $conn=c,
                $identifier=cat(c$id$orig_h),
                $msg=fmt("CVE-2020-16898 exploit detected from %s. https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2020-16898#ID0EUGAC . Details from packet for reference: info=%s , options=%s ", c$id$orig_h, info, options)]);
        }
    }